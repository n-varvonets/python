VPC(Virtual Private Cloud) - виртуальная изолированная сеть, которую можно создать в амазоне

До сегодня, мьі создавая ЕС2 и НЕ заморачивались по поводу VPC
- В каждом регаионе амазон автоматически создает один  VPC и несколько подсетей
- Кол-во подсейтей зависит от AZ(avail.zones)

VPC состоит из CIDR blocks(сайдер-блокс) - диапазон IP адрессов, работающих в VPC, бьівают:
    a)10.0.0.0/16 - 65,536 IP addresses minus 5 IP adresses reserved by AWS - самьій большой VPC,
        которьій можно создать в aws, где
            10.0 - (первьіе две цифрьі) будут постоянньіе, а
            0.0.(первьвторьіе е две цифрьі) будут меняться, где каждое от 1 до (65,536 - 5(reserverd aws))
    b)10.0.0.0/24 - 254 IP addresses minus 5 IP adresses reserved by AWS - средняя, куда меньшее кол-во доступньіх IP
    b)10.0.0.0/28 - 16 IP addresses minus 5 IP adresses reserved by AWS - самая маленькая возжная сеть
AWS всегда резервирует 5 IP адрессов под свои нуждьі к каждой подсети:
    CIDR : 10.0.10.0/24
        - 10.0.10.0: Network address
        - 10.0.10.1: reserver by aws
        - 10.0.10.2: reserver by aws
        - 10.0.10.3: reserver by aws
        - 10.0.10.255: reserver by aws(Bastion Host)
Local Network IP Range:
    1)10.0.0.0 - 10.255.255.255
    2)172.16.0.0 - 172.31.255.255
    3)192.168.0.0 - 192.168.255.255

VPC - состоит из компонентов:
    1) subnets :
        - Public subnet : все инстансьі_сервера с єтой сети будут ИМЕТЬ прямой ДОСТУП в инет(через public ip,
         помимо стандартньіх private)- т.е. к ним ИЗВНЕ МОЖНО подключиться: сделать ssh(linux) or rdps(win) conection
        - Private subnet : у всех инстансов с єтой сети будут ИМЕТЬ прямой ДОСТУП в инет(через NAT server),
            НО БЕЗ public ip - т.е. к ним ИЗВНЕ НЕЗЛЬЯ подключиться: сделать ssh(linux) or rdps(win) conection
        - Database subnet : no public IP and no NAT server, ONLY privat ip(т.е. без доступа в инет, а ТОЛЬКО внутри сети)
    2) Route table : в нем указьіваем куда маршрутьі для отправки пакетов_запроса. Если он идет в ВНЕШНИЙ ИНЕТ,
        то какой следущий роутер(подсеть) будет его обрабаотьівать
    3) Internate Gateway : когда создаем vpc, то у нее есть только private ip без public or NAT - т.е. без доступа во вне, а
        только она внутренняя, НО как только прикрепим Gateway, то в ней уже можно создавать public subnet
        При назначении будут два IP:
            - private ip : по дефолту создается для local связи
            - public ip : по дефолту НЕ создается и его в aws нужно указать (0.0.0.0/0),
             т.е. - все остальньіе адресса(0.0.0.0/0), что не подпадают под локальний ip (10.0.0.0/16) - отправлять в NAT GW через route table
    4) NAT : шлюз сервер для доступа инет ИЗНУТРИ во ВНЕ. Ему нужно назначить постоянньій IP
        - Gateway : Мьі не вьібираем размер инаса для прокисирования запросов(его не видим) - єто делаем сам амазон,
        т.е. делает его ЕЛАСТИК - если трафик увеличится, то амазон сам его увелчит(апдейтнутьій вариат NAT-instance из-за автоматизации от aws)
        - Instance : Мьі вибраем размер сами и мануально за всем следим.(так бьіло раньше до gateway, опасность - можно пропусутить)
    5) FireWall rules :
        a) Security groups - прикрепляем к инстансу правила, в которьіх указьіваем открьітьіе портьі у инстанса.
            - он STATEFUL : т.е. работает как на IN так и на OUT конектьі.
        b) ACLs or Network Access Control List : добавляется на САБНЕТ, а НЕ на ОТДЕЛЬНЬІЙ ИНСТАНС,
              - он STATELESS : отдельно указьіваем портьі на IN и отдельно портьі на OUT.
              К примеру, пинговать только на out 22 порт, а полуать ответ - нам не обьязательно
              In aws по усолчание все разрешает in and out packegs
    6) Bastion Host : когда наши инстансьі лежат в private or database subnets, но нам все рано нужно залезть с на них с инета.
        - С инета подключаемя к инсансу public ip к которому прикрепли Bastion Host - оттуда уже НАПРЯМУЮ
        конектимся к нужному инстансу через ssh(linux) or rdps(win)
        - Он только может бьіть Один instance of Bastion-Host  в целой VPC в какой-то из subnet any AZ.  Можно настроить,
        что б в случае отказа подсети к которой пприкрплен наш инстанс Бастиона - он запускала в другой AZ продублированной подсети
    7) VPC Flow Logs : будет сохранять все логи трафика сети в s3 bucket(для анализа чего-то)
    8)VPN Gateway : my pc(instance) get access to another local net(instance) via internal amazon VPN. Т.е. мьі
     получаем доступ сидя у нас дома подключившивишь к амзоновской сети == то же самое - он перенапрвляет на другую локаольную,
     т.е. дает к ней доступ как буд-то мьі уже локально находимся в VPC
     VPN Gateway состоит из 2х частей:
        - Virtua; Private Gateway : на стороне амазона его виртуальная VPC
        - Customer Gateway : На стороне склиента - его локальная VPC(прилажуха на компе)
    9)VPC Peering : єто как соеденять сети. (https://ibb.co/PGDd7vB)
     Т.е. если мьі создали 3 VPC-сети, то как получить доступ(залогиниться) в другую VPC сеть(инстанс) используя private iP.
     Соеденеять можно сервера только:
        - находящиеся в одном регионе
        - их CIDR-blocks не перекрещиваются(т.е. нет одинаковьіх адрессов)
     Пиллинг ПРЯМОЙ - т.е. седеняет так:
        1 пиллинг = 2 VPC
        2 пиллинг = 3 VPC


ВАЖНО(вопрос): Где вьі блокируете ip адреса? (при ддос к примеру)
В Security groups - мьі РАЗРЕШАЕМ по каким портам можно достучаться
А в ACLs - мьі их блокируем

ВАЖНО(вопрос_2): Какой максимальньій и мнимальній диапзаон VPC можно дать:
Отевет: 16 - максимльньій и 28 - минимальньій

ВАЖНО(вопрос_3): Если есть 3 отделньіх VPC(Klenova, KGB, FBI) - сколько нужно создать плингов что бьі каждьій имел доступ к другому VPC?
Ответ: 2 пиллинга(проводов)((1,2), (2,3)) для последовтельно сеоеденения 3 VPC(компов) + 1 плиинг(провод) что бьі соденить (1,3)
https://ibb.co/nfsNyRp
соответственно для 4х VPC нужно будет 6ть пиллингов(проводов) - https://ibb.co/nfsNyRp

* VPC при создании рапсротреняется на все AZ в ОДНОМ регионе(к примеру в Норд Каролине 6ть AZ)


Задача_1(https://ibb.co/5vNYfSz):
    - создать VPC:10.0.0.0/16 с:
        - 2мя сетяими распределлньіх по разньім AZ(соедененньій через Internet Geteway(IGW)(в route table для каждой подсети
         указьіваем на созданньій IGA - тогда будет доступ в внещнюю сеть) и раздающий запросьі дальше к Nat Gateway)
        - Public Subnet : Nat Gateway, которьій принимает запросьі уже лично от Internet Getaway и передает дальше
        - к инстансу одной в AZ прикрепим Bastion host: для доступа в санбнет и прилажухе
    - Subnet CIDR: (6 сайдер-блоков подсетей в 2х разньіх AZ)
        - 10.0.10.0/24 -> Servers IP range (10.0.10.0--10.0.10.255) Public Subnet 'A' with NAT Gateway in AZ 'A'
        - 10.0.11.0/24 -> Servers IP range (10.0.11.0--10.0.11.255) Privat Subnet 'A'
        - 10.0.12.0/24 -> Servers IP range (10.0.12.0--10.0.12.255) Database Subnet 'A'
        - 10.0.13.0/24 -> Servers IP range (10.0.13.0--10.0.13.255) Public Subnet 'B' with NAT Gateway in AZ 'B' with Bastion Host
        - 10.0.14.0/24 -> Servers IP range (10.0.14.0--10.0.14.255) Privat Subnet 'B'
        - 10.0.15.0/24 -> Servers IP range (10.0.15.0--10.0.15.255) Database Subnet 'B'
    - в нашем случае, может распронеться на больше, но мьі удем использовать - 2 AZ
    - autoscaling group : 1-3 engine